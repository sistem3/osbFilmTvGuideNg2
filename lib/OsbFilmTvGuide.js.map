{"version":3,"file":"OsbFilmTvGuide.js","sourceRoot":"","sources":["../src/OsbFilmTvGuide.ts"],"names":[],"mappings":"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","sourcesContent":["import {Component} from '@angular/core';\nimport { Http, HTTP_PROVIDERS } from '@angular/http';\nimport 'ScrollMagic';\ndeclare let ScrollMagic;\nlet scrollScene, scrollController;\n\n@Component({\n    selector: 'osb-film-tv-guide',\n    templateUrl: 'vendor/osb-film-tv-guide/lib/OsbFilmTvGuide.html',\n    styleUrls: ['vendor/osb-film-tv-guide/lib/OsbFilmTvGuide.css']\n})\nexport class OsbFilmTvGuide {\n    isLoading = true;\n    modalShowing = false;\n    storagePrefix = '';\n    baseUrl = '';\n    apiKey = '';\n    section = '';\n    searchTerm = '';\n    pageNumber = 1;\n    feedData = [];\n    modalData = {};\n    user = {\n        favourites: [],\n        watched: []\n    };\n    sections = [];\n\n    constructor(public http: Http) {\n        this.isLoading = true;\n        this.modalShowing = false;\n        this.storagePrefix = 'osbFilmTvGuide.user';\n        this.baseUrl = 'https://api.themoviedb.org/3/';\n        this.apiKey = '892ae99b0451fed76a0ece0a8d0c1414';\n        this.section = 'movie';\n        this.searchTerm = 'popular';\n        this.pageNumber = 1;\n        this.sections = [\n            {name: 'Popular movies', section: 'movie', searchTerm: 'popular', icon: 'fa-film'},\n            {name: 'Upcoming Movies', section: 'movie', searchTerm: 'upcoming', icon: 'fa-film'},\n            {name: 'Top Rated Movies', section: 'movie', searchTerm: 'top_rated', icon: 'fa-film'},\n            {name: 'Popular TV Shows', section: 'tv', searchTerm: 'popular', icon: 'fa-desktop'},\n            {name: 'Top Rated TV Shows', section: 'tv', searchTerm: 'top_rated', icon: 'fa-desktop'}\n        ];\n        if (localStorage.getItem('osbFilmTvGuide.user')) {\n            this.user = JSON.parse(localStorage.getItem('osbFilmTvGuide.user'));\n        }\n        this.getData(this.section, this.searchTerm);\n        //console.log(this.user);\n        var holder = this;\n        window.onbeforeunload = function(e) {\n            holder.destroyEvents();\n        };\n    }\n\n    destroyEvents() {\n        if (scrollScene) {\n            scrollScene.destroy();\n        }\n    }\n\n    addFavourite(id) {\n        if (this.user.favourites) {\n            var exists = false;\n            this.user.favourites.forEach(function(element, index, array) {\n                if(element.id == id) {\n                    exists = true;\n                }\n            });\n            // If the id doesn't exist add\n            if (!exists) {\n                this.user.favourites.push({'section': this.section,'id': id});\n                localStorage.setItem(this.storagePrefix, JSON.stringify(this.user));\n            }\n        }\n        this.checkFavourites(id);\n    }\n\n    checkFavourites(id) {\n        this.user.favourites.forEach(function(element) {\n            if (element.id === id) {\n                setTimeout(function() {\n                    var matchElement = document.getElementById(id);\n                    matchElement.querySelector('.favouriteBtn').classList.add('favouriteActive');\n                }, 100);\n            }\n        });\n    }\n\n    addWatched(id) {\n        if (this.user.watched) {\n            var exists = false;\n            this.user.watched.forEach(function(element, index, array) {\n                if(element.id == id) {\n                    exists = true;\n                }\n            });\n            // If the id doesn't exist add\n            if (!exists) {\n                this.user.watched.push({'section': this.section,'id': id});\n                localStorage.setItem(this.storagePrefix, JSON.stringify(this.user));\n            }\n        }\n        this.checkWatched(id);\n    }\n\n    checkWatched(id) {\n        this.user.watched.forEach(function(element) {\n            if (element.id === id) {\n                setTimeout(function() {\n                    var matchElement = document.getElementById(id);\n                    matchElement.querySelector('.watchedBtn').classList.add('watchedActive');\n                }, 100);\n            }\n        });\n    }\n\n    closeModal() {\n        this.modalShowing = false;\n        this.modalData = {};\n    }\n\n    getDetails(id) {\n        this.http.get(this.baseUrl + this.section + '/' + id + '?api_key=' + this.apiKey)\n            .subscribe(response => this.setDetails(response));\n    }\n\n    setDetails(data) {\n        this.modalData = data.json();\n        this.modalShowing = true;\n    }\n\n    updateData(data) {\n        var holder = this;\n        var updateData = data.json();\n        updateData.results.forEach(function(element) {\n            holder.feedData.push(element);\n        });\n    }\n\n    getMoreData() {\n        this.pageNumber += 1;\n        this.http.get(this.baseUrl + this.section + '/' + this.searchTerm + '?page=' + this.pageNumber + '&api_key=' + this.apiKey)\n            .subscribe(response => this.updateData(response));\n    }\n\n    getData(section, searchTerm) {\n        this.pageNumber = 1;\n        this.isLoading = true;\n        this.section = section;\n        this.http.get(this.baseUrl + section + '/' + searchTerm + '?api_key=' + this.apiKey)\n            .subscribe(response => this.setData(response));\n    }\n\n    setData(data) {\n        var holder = this;\n        var feedData = data.json();\n        this.isLoading = false;\n        this.feedData = feedData.results;\n        feedData.results.forEach(function(element) {\n            holder.checkFavourites(element.id);\n            holder.checkWatched(element.id);\n        });\n        setTimeout(function() {\n            scrollController = new ScrollMagic.Controller();\n            scrollScene = new ScrollMagic.Scene({triggerElement: '#filmLoader', triggerHook: 'onEnter'})\n                .addTo(scrollController)\n                .on('enter', function (e) {\n                    if (document.querySelector('#filmLoader').className.indexOf('active') == -1) {\n                        holder.getMoreData();\n                    }\n                });\n            scrollScene.update();\n        }, 500);\n    }\n\n}"]}